name: Python Application CI

on:
  push:
    branches:
      - production
      - testing
  pull_request:
    branches:
      - production
      - testing

jobs:
  lint:
    name: Lint Python Code
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'  # Use your desired Python version

      - name: Install Linting Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install flake8

      - name: Run flake8 Linter
        run: |
          flake8 --max-line-length=88 .

  safety:
    name: Scan Dependencies for Vulnerabilities
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'  # Use your desired Python version

      - name: Install Safety
        run: |
          python -m pip install --upgrade pip
          pip install safety

      - name: Check for Vulnerabilities
        run: |
          safety check

  build:
    name: Build Portable Executable
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'  # Use your desired Python version

      - name: Install PyInstaller
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller

      - name: Build Executable
        run: |
          pyinstaller --onefile your_script.py  # Replace 'your_script.py' with your actual script name

  test:
    name: Run Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'  # Use your desired Python version

      - name: Install Test Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # Ensure your requirements.txt is present

      - name: Run Tests
        run: |
          python -m unittest discover -s tests  # Adjust if your tests are in a different folder

